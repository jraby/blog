<!DOCTYPE html>
<html lang="en">

{{ partial "head.html" . }}

<body>
    <nav class="site-nav">
        <a href="/">Go back home</a>
    </nav>
    <div class="container">
        <article class="post">
            <h1 class="post-title">{{ .Title }}</h1>
            <time class="post-date">{{ .Date.Format "2 January 2006" }}</time>
            <span class="byline-name" hidden>Nicol√°s Parada</span>
            <div class="post-content">{{ .Content }}</div>
        </article>

        <div class="post-actions">
            {{- if .Params.tweet_id }}
            <a href="https://twitter.com/intent/retweet?tweet_id={{ .Params.tweet_id }}" target="_blank" class="retweet">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter">
                    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
                </svg>
                Retweet
            </a>
            {{ end -}}
        </div>

        <div id="comments" class="comments"></div>
    </div>

    <script>
        const links = Array.from(document.querySelectorAll('a'))
        for (const link of links) {
            if (link.hostname !== location.hostname)
                link.target = '_blank'
        }
    </script>

    <script>
        function loadCSS(href) {
            const link = document.createElement('link')
            link.rel = 'stylesheet'
            link.href = href
            document.head.appendChild(link)
        }

        const loadScript = src => new Promise((resolve, reject) => {
            const script = document.createElement('script')
            script.src = src
            script.onload = resolve
            script.onerror = reject
            document.head.appendChild(script)
        })

        let loadingGitalk = false

        const comments = document.getElementById('comments')

        const observer = new IntersectionObserver(entries => {
            for (const entry of entries) {
                if (!entry.isIntersecting && loadingGitalk) continue

                loadingGitalk = true

                loadCSS('https://unpkg.com/gitalk/dist/gitalk.css')
                loadScript('https://unpkg.com/gitalk/dist/gitalk.min.js').then(() => {
                    if (!('Gitalk' in window)) throw new Error('No Gitalk found on window')

                    const gitalk = new window['Gitalk']({
                        clientID: '307519edbcc010611b77',
                        clientSecret: '2da65e23d64ff6b8c346c5d227a80263e543c339',
                        repo: 'blog',
                        owner: 'nicolasparada',
                        admin: ['nicolasparada'],
                        id: decodeURI("{{ .UniqueID }}").substr(0, 50),
                    })

                    gitalk.render('comments')

                    observer.unobserve(comments)
                    observer.disconnect()
                }).catch(console.error)
                break
            }
        })

        if (!['localhost', '127.0.0.1'].includes(location.hostname)) {
            observer.observe(comments)
        }
    </script>

    {{ template "_internal/google_analytics_async.html" . }}
</body>

</html>
